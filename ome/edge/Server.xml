<?xml version="1.0" encoding="UTF-8"?>
<Server version="8">
        <Name>EDGE</Name>
        <Type>edge</Type>
        <IP>*</IP>
        <PrivacyProtection>false</PrivacyProtection>
        <StunServer>stun.cloudflare.com:3478</StunServer>
        <Modules>
                <HTTP2>
                        <Enable>true</Enable>
                </HTTP2>
                <LLHLS>
                        <Enable>true</Enable>
                </LLHLS>
                <DynamicAppRemoval>
                        <Enable>false</Enable>
                </DynamicAppRemoval>
                <P2P>
                        <Enable>false</Enable>
                        <MaxClientPeersPerHostPeer>2</MaxClientPeersPerHostPeer>
                </P2P>
        </Modules>

        <!-- The WorkerCount in <Bind> can set the thread responsible for sending and receiving over the socket.  -->
        <Bind>
                <Providers>
                        <OVT>
                                <WorkerCount>3</WorkerCount>
                        </OVT>
                </Providers>

                <Publishers>
                        <WebRTC>
                                <Signalling>
                                        <TLSPort>3334</TLSPort>
                                        <WorkerCount>2</WorkerCount>
                                </Signalling>
                                <IceCandidates>
                                        <IceCandidate>${env:PublicIP:*}:10000-10009/udp</IceCandidate>
                                        <TcpRelay>${env:PublicIP:*}:3478</TcpRelay>
                                        <TcpForce>true</TcpForce>
                                        <TcpRelayWorkerCount>1</TcpRelayWorkerCount>
                                </IceCandidates>
                        </WebRTC>

			<LLHLS>
				<TLSPort>4334</TLSPort>
				<WorkerCount>2</WorkerCount>
			</LLHLS>
                        <HLS>
                                <TLSPort>13334</TLSPort>
                                <WorkerCount>1</WorkerCount>
                        </HLS>
		</Publishers>

		<Managers>
			<API>
				<TLSPort>8082</TLSPort>
				<WorkerCount>1</WorkerCount>
			</API>
		</Managers>
	
        </Bind>

	<Managers>
		<Host>
			<Names>
				<Name>${env:OME_HOST_IP:*}</Name>
			</Names>
			<TLS>
				<CertPath>/opt/ovenmediaengine/bin/origin_conf/cert.crt</CertPath>
				<KeyPath>/opt/ovenmediaengine/bin/origin_conf/cert.key</KeyPath>
				<ChainCertPath>/opt/ovenmediaengine/bin/origin_conf/cert.ca-bundle</ChainCertPath>
			</TLS>
		</Host>
		<API>
                <AccessToken>${env:API_ACCESS_TOKEN:}</AccessToken>
                <CrossDomains>
                        <Url>*</Url>
                </CrossDomains>
        </API>
	</Managers>

        <VirtualHosts>

                <VirtualHost>
                        <Name>live</Name>
                        <Distribution>muselink.com</Distribution>
                        <Host>
                                <Names>
                                        <Name>${env:OME_HOST_IP:*}</Name>
                                </Names>
                                <TLS>
                                        <CertPath>/opt/ovenmediaengine/bin/origin_conf/cert.crt</CertPath>
                                        <KeyPath>/opt/ovenmediaengine/bin/origin_conf/cert.key</KeyPath>
                                        <ChainCertPath>/opt/ovenmediaengine/bin/origin_conf/cert.ca-bundle</ChainCertPath>
                                </TLS>
                        </Host>
        
                        <AdmissionWebhooks>
                                <ControlServerUrl>https://api.muselink.com/pre/ome/admission</ControlServerUrl>
                                <SecretKey>${env:ADMISSION_WEBHOOK_SECRET_KEY}</SecretKey>
                                <Timeout>15000</Timeout>
                                <Enables>
                                        <Providers>rtmp,webrtc,srt</Providers>
                                        <Publishers>webrtc,llhls</Publishers>
                                </Enables>
                        </AdmissionWebhooks>

                        <Origins>
                                <Properties>
                                        <NoInputFailoverTimeout>3000</NoInputFailoverTimeout>
                                        <UnusedStreamDeletionTimeout>60000</UnusedStreamDeletionTimeout>
                                </Properties>
                                <Origin>
                                        <Location>/</Location>
                                        <Pass>
                                                <Scheme>ovt</Scheme>
                                                <Urls>
                                                        <Url>live-ca-rise2-origin.muselink.com:9000/</Url>
                                                </Urls>
                                                <ForwardQueryParams>true</ForwardQueryParams>
                                        </Pass>
                                </Origin>
                        </Origins>


                        <CrossDomains>
                                <Url>*</Url>
                        </CrossDomains>

                        <Applications>
                                <Application>
                                        <Name>*</Name>
                                        <Type>live</Type>
                                        <OutputProfiles>
                                                <OutputProfile>
                                                        <Name>passthrough</Name>
                                                        <OutputStreamName>${OriginStreamName}</OutputStreamName>
                                                        <Encodes>
                                                                <Video>
                                                                        <Bypass>true</Bypass>
                                                                </Video>
                                                                <Audio>
                                                                        <Bypass>true</Bypass>
                                                                </Audio>
                                                        </Encodes>
                                                </OutputProfile>
                                        </OutputProfiles>
                                        <Providers>
                                                <OVT />
                                        </Providers>
                                        <Publishers>
                                                <AppWorkerCount>1</AppWorkerCount>
                                                <StreamWorkerCount>8</StreamWorkerCount>
                                                <WebRTC>
                                                        <Timeout>30000</Timeout>
                                                        <Rtx>false</Rtx>
                                                        <Ulpfec>false</Ulpfec>
                                                        <JitterBuffer>false</JitterBuffer>
                                                        <CreateDefaultPlaylist>false</CreateDefaultPlaylist>
                                                </WebRTC>
                                                <LLHLS>
                                                        <ChunkDuration>0.2</ChunkDuration>
                                                        <SegmentDuration>6</SegmentDuration>
                                                        <SegmentCount>10</SegmentCount>
                                                        <CrossDomains>
                                                                <Url>*</Url>
                                                        </CrossDomains>
                                                        <DVR>
                                                                <Enable>false</Enable>
                                                                <TempStoragePath>/tmp/ome_dvr/</TempStoragePath>
                                                                <MaxDuration>300</MaxDuration>
                                                        </DVR>
                                                        </LLHLS>
                                                <HLS>
                                                        <SegmentDuration>6</SegmentDuration>
                                                        <SegmentCount>5</SegmentCount>
                                                        <DVR>
                                                                <Enable>false</Enable>
                                                                <EventPlaylistType>false</EventPlaylistType>
                                                                <TempStoragePath>/tmp/ome_dvr/</TempStoragePath>
                                                                <MaxDuration>300</MaxDuration>
                                                        </DVR>
                                                        <CrossDomains>
                                                                <Url>*</Url>
                                                        </CrossDomains>
                                                </HLS>
                                        </Publishers>
                                </Application>
                        </Applications>
                </VirtualHost>
        </VirtualHosts>
</Server>
